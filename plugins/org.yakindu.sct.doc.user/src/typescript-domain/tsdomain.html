<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<h1 id="tsdom-using-typescript-in-statecharts">Using TypeScript in statecharts</h1>
<h2 id="tsdom-introduction">Introduction</h2>
<p>You can use TypeScript artifacts like classes, interfaces, enums, variables, etc., directly in your statechart model. The <em>TypeScript</em> domain, which is available in the Professional Edition of YAKINDU Statechart Tools, automatically recognizes TypeScript files that are local to your workspace and makes all type and operation declarations within them available to your statechart model.</p>
<p>The following sections explain by means of a sample human-machine interface (HMI) project how the TypeScript domain can be practically used. We will see that a statechart can not only <em>model</em> an HMI, it can also <em>implement</em> it – or at least implement its control flow and page flow.</p>
<p>In this example, we will use an Angular project and demonstrate how the TypeScript artifacts can be used in the statechart model. The example also shows</p>
<ul>
<li>how TypeScript code can be generated from a statechart model and</li>
<li>how the generated artifact is integrated into an Angular application.</li>
</ul>
<h2 id="tsdom-a-sample-hmi-application">A sample HMI application</h2>
<p><img src="images/tsdomain_hmimain.png" title="HMI main screen" alt="HMI main screen" /></p>
<p>HMI main screen</p>
<p>In this example, we have a look at a simple HMI that represents an infotainment system for cars. You can find it in the YAKINDU Statechart Tools <a href="https://github.com/Yakindu/examples/wiki">example repository on Github</a>.</p>
<p>This application consists of three screens:</p>
<ul>
<li>Blank screen: shows a black window</li>
<li>Start screen: shows a welcome animation</li>
<li>Main screen: consist of severals components (speedometer, light widgets, infotainment, etc.)</li>
</ul>
<p><img src="images/tsdomain_hmimain2.png" title="HMI main screen" alt="HMI main screen" /></p>
<p>The infotainment component represents a container for further components like <em>infotainment menu</em>, <em>weather</em>, <em>music player</em>, and <em>phone</em>.</p>
<p><img src="images/tsdomain_screens.png" title="HMI screens" alt="HMI screens" /></p>
<p>HMI screens</p>
<h2 id="tsdom-modeling-behavior-with-yakindu-statechart-tools-professional">Modeling behavior with YAKINDU Statechart Tools Professional</h2>
<p>In this section we will model two statecharts. The first one controls the screens, the second statechart controls the music player.</p>
<h3 id="tsdom-importing-the-sample-angular-2-project-into-eclipse">Importing the sample Angular project into Eclipse</h3>
<p>The sample application has to be imported into the Eclipse workspace.</p>
<ol>
<li>In the Eclipse main menu, select <em>File → Import</em>. The <em>Import</em> dialog opens.</li>
<li>Select <em>General → Projects from Folder or Archive</em>. <br/><img src="images/tsdomain_import_dialog.png" title="Import dialog" alt="Import dialog" /></li>
<li>Click <em>Next</em>. The <em>Import Projects from File System or Archive</em> dialog appears.</li>
<li>Open the directory folder of the Angular application by clicking on the <em>Directory</em> button.<br/><img src="images/tsdomain_import2_dialog.png" title="Import dialog" alt="Import dialog" /></li>
<li>Click <em>Finish</em>. The project explorer should now look like this:<br/><img src="images/tsdomain_project_explorer.png" title="Project explorer" alt="Project explorer" /></li>
<li>Open the project's context menu and add the <em>YAKINDU SCT Nature</em>. <img src="images/tsdomain_add_sct_nature.gif" title="Add Yakindu SCT nature" alt="Add Yakindu SCT nature" /></li>
</ol>
<h3 id="tsdom-creating-a-new-project-for-statechart-models">Creating a new project for statechart models</h3>
<p>The next step is to create a statechart project that makes use of the Angular project resp. of the TypeScript artifacts therein.</p>
<ol>
<li>In the Eclipse main menu, select <em>File → New → Project</em>. The <em>New Project</em> dialog appears.</li>
<li>Select <em>General → Project</em> and click <em>Next</em>.</li>
<li>In the <em>Project name</em> field, enter a project name, e.g. <strong>yCarSct</strong>. Then click <em>Finish</em>.</li>
<li>The project explorer should now look like this:<br/><img src="images/tsdomain_project_explorer_sct.png" title="Project explorer" alt="Project explorer" /></li>
<li>This project needs a reference to the Angular project. To set the reference, do the following:
<ol>
<li>Right-click on the <em>yCarSct</em> project. The context menu opens.</li>
<li>In the context menu, select <em>Properties</em>. The <em>Properties</em> dialog appears.</li>
<li>Select <em>Project References</em>.</li>
<li>Make sure that the Angular project (ycar_app) is selected.<br/><img src="images/tsdomain_project_ref.gif" title="Project reference" alt="Project reference" /></li>
<li>Click on <em>OK</em>.</li>
</ol></li>
</ol>
<h3 id="tsdom-creating-a-statechart-model-using-the-typescript-domain">Creating a statechart model using the TypeScript domain</h3>
<p>Now that we have a statechart project, let's create a statechart model using the TypeScript data types.</p>
<ol>
<li>Right-click on the <em>yCarSct</em> project. The context menu opens.</li>
<li>In the context menu, select <em>New → Statechart Model</em>. The <em>New YAKINDU Statechart Wizard</em> opens.</li>
<li>In the dialog, specify directory and filename for the new statechart model file. The filename must end with <em>.sct</em>.</li>
<li>Click <em>Finish</em>. If Eclipse asks you whether to switch to the <em>YAKINDU Modeling perspective</em>, please confirm.</li>
<li>The new statechart model is created. <img src="images/tsdomain_create_statechart_model.png" title="Statechart model" alt="Statechart model" /></li>
</ol>
<h4 id="tsdom-Defining-a-typescript-type-variable-in-a-statechart">Defining a TypeScript-type variable in a statechart</h4>
<p>Statechart variables are defined in the definition section on the left-hand side of the statechart editor. Double-click into the definition section to edit it.</p>
<p>Let's declare a variable <em>routerService</em> of type <em>RouterService</em>. Type <code>var routerService:</code>, then press <code>[Ctrl+Space]</code> in order to see which types are available.</p>
<p>The content assist opens and shows the TypeScript types available in the Angular TypeScript sample application.<br/><img src="images/tsdomain_var.png" title="Content assist" alt="Content assist" /></p>
<p>In the content assist menu, select the <em>RouterService</em> entry to complete the variable definition.</p>
<p><img src="images/tsdomain_routerService_var.png" title="Definition section - routerService" alt="Definition section - routerService" /></p>
<p>Definition section - routerService</p>
<h4 id="tsdom-using-a-typescript-variable-in-a-statechart">Using a TypeScript variable in a statechart</h4>
<p>This section shows how the TypeScript variable we have defined above can actually be used.</p>
<p>For this purpose, let's consider the following scenario. In the user interface, the blank screen is show. After three seconds, it should change to the main screen.</p>
<p>Figure <a href="#tsdom-fig-sample-screen-changing-statechart-model">Diagram Appearance</a> show how this is modeled. When the specified time has elapsed, a transition takes place with <em>blankScreen</em> as its origin and with <em>mainScreen</em> as its target state.</p>
<p><img src="images/tsdomain_sct_var.png" title="Sample screen-changing statechart model" alt="Sample screen-changing statechart model" /></p>
<p>Sample screen-changing statechart model</p>
<p>The clou is in the <em>mainScreen</em> state's entry action, because it connects the statechart model with the actual user interface implementation, say, a browser. The connection is done via the <em>routerService</em> variable. The entry action calls <em>routerService</em>'s <em>navigate</em> method, passes the parameter <code>&quot;/mainScreen&quot;</code>, and this in turn – in this case – directs the browser to open the &quot;/mainScreen&quot; URL.</p>
<p>A statechart variable with a TypeScript type can be used everywhere a &quot;normal&quot; statechart variable can be used.</p>
<h3 id="tsdom-creating-a-statechart-generator-model">Creating a statechart generator model</h3>
<p>Our goal is that the statechart is generated into the Angular&amp;nbsp;2 project. For configuring the code generation process, YAKINDU Statechart Tools uses a textual generator model called <em>SGen</em>. It can be created either by using the <em>YAKINDU Statechart Generator Model</em> wizard or by manually creating a text file containing the SGen model. Such a file must have the filename extension <em>.sgen</em>.</p>
<p>To create a generator model with the wizard, proceed as follows:</p>
<ol>
<li>In the main menu, select <em>File → New → YAKINDU SCT → Code Generator Model</em>. The wizzard opens.</li>
<li>Enter a name and click <em>Next</em>.</li>
<li>Choose the <em>YAKINDU SCT TypeScript Generator</em> generator.</li>
<li>Check the model(s) to generate code from.</li>
<li>Click <em>Finish</em>.</li>
</ol>
<p><img src="images/tsdomain_genmodel_config.png" title="SCT generator model configuration wizzard" alt="SCT generator model configuration wizzard" /></p>
<p>SCT generator model configuration wizard</p>
<p>The result is an <em>.sgen</em> file of the following format:</p>
<p><img src="images/tsdomain_sgen.png" title="SCT generator model" alt="SCT generator model" /></p>
<p>SCT generator model</p>
<p>The <strong>Outlet</strong> feature specifies target project and target folder for the generated artifacts. It is a <em>required</em> feature and has the following parameters:</p>
<ol>
<li><strong>targetProject</strong> (String, required): The project to store the generated artifacts to.</li>
<li><strong>targetFolder</strong> (String, required): The folder to store the generated artifacts to. Unless at least one of the optional <em>libraryTargetFolder</em> and <em>apiTargetFolder</em> parameters (see below) are given, all artifacts will be generated into the <em>targetFolder</em>. Each of them will be overwritten during re-generation.</li>
<li><strong>libraryTargetFolder</strong> (String, optional): The folder to store <em>model-independent artifacts</em> to. The artifacts in this folder will be preserved during re-generation, i.e. they will written once and not be overwritten. If this parameter is not specified, model-independent artifacts will be written to the <em>targetFolder</em>.</li>
<li><strong>apiTargetFolder</strong> (String, optional): The folder to store <em>API code</em> to, e.g. interfaces or header files. If this parameter is not specified, these artifacts will be generated into the target folder.</li>
</ol>
<p>In our example the generator model looks like this:</p>
<p><img src="images/tsdomain_sgen2.png" title="SCT generator model example configuration" alt="SCT generator model example configuration" /></p>
<p>SCT generator model example configuration</p>
<p>That is, the Angular project <em>ycarApp</em> is augmented by the <em>src/app/gen</em> folder containing the generated artifacts. In order to start generating TypeScript code from your statechart, just save the statechart model.</p>
<p>After generation is done, you can find the generated TypeScript code in the specified <em>gen</em> directory:</p>
<p><img src="images/tsdomain_genfolder.png" title="Generated file structure" alt="Generated file structure" /></p>
<p>Generated file structure</p>
<h3 id="tsdom-integrating-the-generated-typescript-statemachine-into-an-angular-2-application">Integrating the generated TypeScript statemachine into an Angular application</h3>
<p>In the context of Angular, the generated statechart is a <em>service</em>. To integrate it with the application, proceed as follows:</p>
<ol>
<li>Customize the <em>app.module.ts</em> file as follows:<br/><img src="images/tsdomain_ngmodule.png" title="NgModel customization" alt="NgModel customization" /></li>
<li>Customize the <em>app.comonent.ts</em> file as follows:<br/><img src="images/tsdomain_ngcomponent.png" title="NgComponent customization" alt="NgComponent customization" /></li>
</ol>
<p>When you start the Angular application, it should behave like this:</p>
<p><img src="images/tsdomain_hmi.gif" title="Generated HMI behaviour" alt="Generated HMI behaviour" /></p>
<p>Generated HMI behaviour</p>
</body>
</html>
